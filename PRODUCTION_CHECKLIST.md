# Production Checklist

## Backend (Django)

### Configuration
- [ ] `DEBUG=False` in production environment
- [ ] `SECRET_KEY` is randomly generated and stored in environment variable
- [ ] `ALLOWED_HOSTS` configured with production domain(s)
- [ ] `SECURE_SSL_REDIRECT=True` for HTTPS enforcement
- [ ] `SESSION_COOKIE_SECURE=True` for HTTPS-only cookies
- [ ] `CSRF_COOKIE_SECURE=True` for HTTPS-only CSRF token
- [ ] `CORS_ALLOWED_ORIGINS` configured with frontend domain(s)
- [ ] `CSRF_TRUSTED_ORIGINS` configured with frontend domain(s)
- [ ] `SHORT_URL_DOMAIN` set to production domain
- [ ] Database URL stored in environment variable (not hardcoded)
- [ ] Static files configured with `STATIC_ROOT` and WhiteNoise

### Security Headers
- [ ] `X-Content-Type-Options: nosniff` (Django default)
- [ ] `X-Frame-Options: DENY` (Django default)
- [ ] Session cookies set to `HttpOnly` and `Secure`
- [ ] CSRF tokens configured properly

### Database
- [ ] PostgreSQL configured (not SQLite)
- [ ] Database URL in environment variable
- [ ] Migrations applied: `python manage.py migrate`
- [ ] Superuser created: `python manage.py createsuperuser`
- [ ] Automated backups enabled

### Dependencies
- [ ] `requirements.txt` includes all necessary packages:
  - Django
  - django-cors-headers
  - python-dotenv
  - gunicorn
  - whitenoise
  - psycopg2-binary
- [ ] Installed with: `pip install -r requirements.txt`

### Logging & Monitoring
- [ ] Logging configured for production
- [ ] Error tracking set up (e.g., Sentry)
- [ ] Monitor Render logs regularly

### API Endpoints
- [ ] `/api/urls/create/` requires authentication (login_required)
- [ ] `/api/urls/` returns only current user's URLs
- [ ] `/api/urls/{id}/analytics/` verifies user ownership
- [ ] `/api/urls/{id}/delete/` verifies user ownership
- [ ] `/s/<short_code>/` works without authentication (public redirect)
- [ ] CORS headers present in all API responses

---

## Frontend (React on Vercel)

### Configuration
- [ ] `REACT_APP_API_BASE_URL` environment variable configured
- [ ] No hardcoded `localhost` URLs in code
- [ ] API base URL uses HTTPS in production

### Environment Variables
- [ ] `.env.example` checked into repository (no secrets)
- [ ] `.env.local` in `.gitignore` (not checked in)
- [ ] Vercel environment variables configured:
  - `REACT_APP_API_BASE_URL=https://your-backend-domain.com`

### Build
- [ ] `npm run build` produces optimized build
- [ ] Build size is reasonable (check Vercel build logs)
- [ ] No console warnings or errors in production build

### Authentication
- [ ] Fetch requests include `credentials: 'include'` for cookies
- [ ] CSRF token extracted from cookies: `csrftoken`
- [ ] CSRF token sent as `X-CSRFToken` header in requests
- [ ] Session cookie received and stored
- [ ] Session persists across page reloads

### API Integration
- [ ] `urlApi.js` uses `REACT_APP_API_BASE_URL` environment variable
- [ ] All API calls use `fetchWithAuth` helper
- [ ] Error handling for 401/403 redirects to login
- [ ] Properly handles CORS pre-flight requests

### Routes
- [ ] Protected routes require authentication
- [ ] Login/signup routes redirect to home if already logged in
- [ ] Unauthorized access redirects to login

### Deploy
- [ ] Connected to GitHub repository
- [ ] Auto-deploy on push to main branch
- [ ] Build command: `npm run build`
- [ ] Install command: `npm install`

---

## Cross-Domain Authentication

### Session Cookies
- [ ] `SameSite=Lax` configured on both backend and frontend
- [ ] Cookies sent with `credentials: 'include'`
- [ ] Domain set to support both main domain and subdomains

### HTTPS
- [ ] Frontend uses HTTPS (Vercel default)
- [ ] Backend uses HTTPS (Render with SSL)
- [ ] HTTP redirects to HTTPS (if domain allows)

### CORS Headers
- [ ] `Access-Control-Allow-Credentials: true`
- [ ] `Access-Control-Allow-Origin: https://your-frontend-domain`
- [ ] `Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS`
- [ ] Preflight requests (OPTIONS) handled correctly

### Testing
- [ ] Can log in from frontend
- [ ] Can create URLs while logged in
- [ ] Can view only own URLs in history
- [ ] Session persists when navigating
- [ ] Logout clears session
- [ ] Redirects work across domains

---

## Deployment Checklist

### Render Backend
- [ ] PostgreSQL database created
- [ ] Web Service created with correct build/start commands
- [ ] Environment variables configured
- [ ] Domain configured (if using custom domain)
- [ ] SSL certificate auto-generated by Render
- [ ] Health check passing

### Vercel Frontend
- [ ] GitHub repository connected
- [ ] Environment variables configured
- [ ] Build succeeded without errors
- [ ] Domain configured (if using custom domain)
- [ ] SSL certificate auto-generated by Vercel

### DNS Configuration
- [ ] Backend CNAME points to Render domain
- [ ] Frontend CNAME points to Vercel domain
- [ ] DNS changes propagated (may take up to 48 hours)

---

## Testing in Production

### Authentication Flow
1. [ ] Visit frontend domain
2. [ ] Click "Sign Up" and create new account
3. [ ] Log in with credentials
4. [ ] Check DevTools → Cookies for `sessionid`
5. [ ] Verify `sessionid` is Secure and HttpOnly

### URL Creation & History
1. [ ] Create a short URL from an unshortneed form
2. [ ] Verify short URL is returned
3. [ ] Go to "My History"
4. [ ] Verify only your URLs are shown
5. [ ] Log out and back in
6. [ ] Verify history persists

### Short URL Redirect
1. [ ] Copy a short URL
2. [ ] Open in new incognito window
3. [ ] Verify it redirects to original URL
4. [ ] Check no authentication required

### Error Handling
1. [ ] Try accessing protected route without login (redirects)
2. [ ] Try invalid short code (404 page)
3. [ ] Try deleting someone else's URL (403 error)

---

## Monitoring After Deployment

### Daily
- [ ] Check Render logs for errors
- [ ] Check Vercel deploy logs for warnings

### Weekly
- [ ] Review database size
- [ ] Check for failed requests in logs
- [ ] Monitor API response times

### Monthly
- [ ] Review error patterns
- [ ] Check for outdated dependencies
- [ ] Test disaster recovery (restore from backup)

---

## Security Reminders

- ⚠️ Never commit `.env` files to repository
- ⚠️ Rotate `SECRET_KEY` if compromised
- ⚠️ Keep Django and dependencies updated
- ⚠️ Use strong passwords for superuser accounts
- ⚠️ Monitor for suspicious login attempts
- ⚠️ Enable database backups and test restoration
- ⚠️ Use strong database passwords
- ⚠️ Regularly audit firewall/security rules

---

## Rollback Plan

If something breaks in production:

1. **Immediate Recovery**
   - Check recent commit: `git log --oneline`
   - Revert to last stable version: `git revert <commit-hash>`
   - Push to main branch (Vercel/Render auto-deploy)

2. **Database Issues**
   - Render provides 7-day backup history
   - Restore from latest backup in Render dashboard
   - Run migrations again if needed

3. **Configuration Issues**
   - Review environment variables in Render/Vercel dashboards
   - Ensure all required variables are set correctly
   - Redeploy with corrected configuration

---
